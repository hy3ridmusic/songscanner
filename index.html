<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Music QR Scanner</title>
<style>
  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(160deg, #6a0dad, #9b59b6);
    color: #fff;
    text-align: center;
    padding: 20px;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: start;
    align-items: center;
  }

  h1 {
    margin-bottom: 25px;
    font-weight: 600;
    font-size: 24px;
    text-shadow: 1px 1px 5px rgba(0,0,0,0.3);
  }

  #reader {
    position: relative;
    width: 320px;
    height: 320px;
    max-width: 90%;
    background: rgba(255,255,255,0.08);
    border: 3px solid rgba(255,255,255,0.9);
    border-radius: 22px;
    display: flex;
    justify-content: center;
    align-items: center;
    overflow: hidden;
    transition: box-shadow 0.3s ease;
  }

  #reader.active {
    box-shadow: 0 0 20px 6px rgba(255,255,255,0.8);
  }

  #reader video {
    width: 100% !important;
    height: 100% !important;
    object-fit: cover;
    object-position: center;
    border-radius: 22px;
  }

  #playerContainer {
    margin-top: 25px;
    width: 320px;
    max-width: 90%;
    position: relative;
    background: rgba(255,255,255,0.1);
    border-radius: 25px;
    padding: 10px;
  }

  iframe {
    width: 100%;
    height: 160px; /* bigger player for easier tapping */
    border-radius: 25px;
    border: none;
  }

  #scanAgain {
    margin-top: 55px; /* pushed lower below player */
    padding: 18px 35px; /* bigger button */
    border: none;
    border-radius: 25px;
    font-size: 18px; /* larger text */
    cursor: pointer;
    font-weight: 600;
    transition: transform 0.2s ease, background 0.3s ease, box-shadow 0.3s ease;
    background: #fff;
    color: #6a0dad;
    display: none;
    box-shadow: 0 4px 15px rgba(0,0,0,0.25); /* subtle shadow */
  }

  #scanAgain:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 20px rgba(255,255,255,0.4); /* glow effect on hover */
  }

  @media (max-width: 400px) {
    h1 {
      font-size: 20px;
    }
    #reader, #playerContainer {
      width: 90%;
    }
  }
</style>
</head>
<body>

<h1>Scan a QR to play the song</h1>

<div id="reader"></div>

<div id="playerContainer">
  <iframe id="playerIframe" src="" allowtransparency="true" allow="encrypted-media" autoplay></iframe>
</div>

<button id="scanAgain" onclick="restartScanner()">Scan Another</button>

<script src="https://unpkg.com/html5-qrcode"></script>
<script>
const songs = {
  "RG01": "https://open.spotify.com/embed/track/5YoITs1m0q8UOQ4AW7N5ga",
  "RG02": "https://open.spotify.com/embed/track/0xVQGRRzpWgT9cshNdbx6B",
  "RG03": "https://open.spotify.com/embed/track/3H7l8S1wD6V9uQzxE6bE2O",
  "RG04": "https://open.spotify.com/embed/track/2k3j9iA5Lr1bV3qTzZcX12",
  "RG05": "https://open.spotify.com/embed/track/1H8oZ0F1l7Mx0z1oP3p3s9"
};

let currentSongUrl = "";
const html5QrCode = new Html5Qrcode("reader");

function playSong(id) {
  const cleanId = id.trim();
  const url = songs[cleanId];
  if (url) {
    currentSongUrl = url;
    document.getElementById("playerIframe").src = url + "?autoplay=1";
    document.getElementById("scanAgain").style.display = "inline-block";
  }
}

function startScanner() {
  document.getElementById("scanAgain").style.display = "none";
  document.getElementById("playerIframe").src = "";

  const reader = document.getElementById("reader");
  reader.classList.remove("active");

  Html5Qrcode.getCameras().then(devices => {
    if (devices && devices.length) {
      html5QrCode.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: { width: 250, height: 250 } },
        qrCodeMessage => {
          reader.classList.add("active");
          html5QrCode.stop();
          playSong(qrCodeMessage);
        },
        errorMessage => console.log(errorMessage)
      );
    }
  }).catch(err => console.error(err));
}

function restartScanner() {
  startScanner();
}

startScanner();
</script>

</body>
</html>
