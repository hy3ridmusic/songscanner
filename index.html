<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Music QR Scanner</title>
<style>
  /* General body */
  body {
    font-family: 'Poppins', sans-serif;
    background: linear-gradient(160deg, #6a0dad, #9b59b6);
    color: #fff;
    text-align: center;
    padding: 20px;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: start;
    align-items: center;
  }

  h1 {
    margin-bottom: 20px;
    font-weight: 600;
    font-size: 24px;
    text-shadow: 1px 1px 5px rgba(0,0,0,0.3);
  }

  #reader {
    width: 320px;
    max-width: 90%;
    padding: 15px;
    background: rgba(255,255,255,0.1);
    border-radius: 20px;
    border: 2px solid #fff;
    margin-bottom: 25px;
  }

  #playerContainer {
    margin-top: 10px;
    width: 320px;
    max-width: 90%;
    position: relative;
    background: rgba(255,255,255,0.1);
    border-radius: 20px;
    padding: 10px;
  }

  iframe {
    width: 100%;
    height: 80px;
    border-radius: 15px;
    border: none;
  }

  #playBtn, #scanAgain {
    margin-top: 15px;
    padding: 12px 25px;
    border: none;
    border-radius: 25px;
    font-size: 16px;
    cursor: pointer;
    font-weight: 600;
    transition: transform 0.2s ease;
  }

  #playBtn {
    background: #fff;
    color: #6a0dad;
    display: none;
  }

  #playBtn:hover {
    transform: scale(1.05);
  }

  #scanAgain {
    background: #fff;
    color: #6a0dad;
    display: none;
  }

  #scanAgain:hover {
    transform: scale(1.05);
  }

  @media (max-width: 400px) {
    h1 {
      font-size: 20px;
    }
    #reader, #playerContainer {
      width: 90%;
    }
  }
</style>
</head>
<body>

<h1>Scan a QR to play the song</h1>

<div id="reader"></div>

<div id="playerContainer">
  <iframe id="playerIframe" src="" allowtransparency="true" allow="encrypted-media"></iframe>
  <button id="playBtn" onclick="playTrack()">Play</button>
</div>

<button id="scanAgain" onclick="restartScanner()">Scan Another</button>

<script src="https://unpkg.com/html5-qrcode"></script>
<script>
const songs = {
  "RG01": "https://open.spotify.com/embed/track/5YoITs1m0q8UOQ4AW7N5ga",
  "RG02": "https://open.spotify.com/embed/track/0xVQGRRzpWgT9cshNdbx6B",
  "RG03": "https://open.spotify.com/embed/track/3H7l8S1wD6V9uQzxE6bE2O",
  "RG04": "https://open.spotify.com/embed/track/2k3j9iA5Lr1bV3qTzZcX12",
  "RG05": "https://open.spotify.com/embed/track/1H8oZ0F1l7Mx0z1oP3p3s9"
};

let currentSongUrl = "";
const html5QrCode = new Html5Qrcode("reader");

function playSong(id) {
  const cleanId = id.trim();
  const url = songs[cleanId];
  if (url) {
    currentSongUrl = url;
    document.getElementById("playerIframe").src = url;
    document.getElementById("playBtn").style.display = "inline-block";
    document.getElementById("scanAgain").style.display = "inline-block";
  }
}

function playTrack() {
  // Reload iframe with autoplay param
  document.getElementById("playerIframe").src = currentSongUrl + "?autoplay=1";
  document.getElementById("playBtn").style.display = "none";
}

function startScanner() {
  document.getElementById("scanAgain").style.display = "none";
  document.getElementById("playBtn").style.display = "none";
  document.getElementById("playerIframe").src = "";

  Html5Qrcode.getCameras().then(devices => {
    if (devices && devices.length) {
      html5QrCode.start(
        { facingMode: "environment" },
        { fps: 10, qrbox: 250 },
        qrCodeMessage => {
          html5QrCode.stop();
          playSong(qrCodeMessage);
        },
        errorMessage => console.log(errorMessage)
      );
    }
  }).catch(err => console.error(err));
}

function restartScanner() {
  startScanner();
}

// Start scanner initially
startScanner();
</script>

</body>
</html>
